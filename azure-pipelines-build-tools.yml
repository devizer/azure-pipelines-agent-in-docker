trigger:
  branches:
    include:
    - master
  paths:
    include:
    - 'build-tools/*'

jobs:
- job: Build
  pool:
    vmImage: 'ubuntu-20.04'
  timeoutInMinutes: 360

  steps:
  - script: |
      function get_cpu_name() {
        # only x86_64 and arm
        local cpu="$(cat /proc/cpuinfo | grep -E '^(model name|Hardware)' | awk -F':' 'NR==1 {print $2}')"
        cpu="$(echo -e "${cpu:-}" | sed -e 's/^[[:space:]]*//')"
        echo "${cpu:-}"
      }

      echo "CPU: $(get_cpu_name)"
      cd build-tools
      sudo apt-get update | grep Get || true;
      bash -e Build-and-Deploy-Git.sh
    displayName: 'build'

  - task: PublishBuildArtifacts@1
    condition: succeededOrFailed()
    displayName: 'Publish'
    inputs:
      pathtoPublish: '$(System.ARTIFACTSDIRECTORY)'
      artifactName: 'Deploy-it-by-$(Agent.JobName)'

